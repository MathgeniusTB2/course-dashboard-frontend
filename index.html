<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Assessment Dashboard</title>
    <style>
        :root {
            --bg: #f5f7fa;
            --card-bg: #fff;
            --text: #333;
            --accent: #3498db;
            --accent-dark: #2980b9;
            --secondary: #2ecc71;
            --danger: #e74c3c;
            --danger-dark: #c0392b;
            --shadow: 0 3px 10px rgba(0,0,0,0.1);
            --header-bg: #3498db;
            --header-text: #fff;
            --tag-type-bg: #e3f2fd;
            --tag-type-text: #1976d2;
            --tag-individual-bg: #e8f5e9;
            --tag-individual-text: #388e3c;
            --tag-group-bg: #fff3e0;
            --tag-group-text: #e65100;
            --prereq-bg: #f8f9fa;
            --neon-blue: #00eaff;
            --neon-green: #39ff14;
            --neon-pink: #ff4fff;
            --neon-orange: #ffb86c;
            --neon-yellow: #ffe347;
            --neon-purple: #a259ff;
            --neon-red: #ff4f4f;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen,
                         Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            margin: 0;
            padding: 20px;
            color: var(--text);
            background-color: var(--bg);
        }
        .dark-theme {
            --bg: #15181e;
            --card-bg: #23262e;
            --text: #e3e8f0;
            --accent: #5ecbfa;
            --accent-dark: #1976d2;
            --secondary: #43e97b;
            --danger: #ff5c5c;
            --danger-dark: #c0392b;
            --shadow: 0 3px 16px rgba(0,0,0,0.8);
            --header-bg: #23262e;
            --header-text: #e3e8f0;
            --tag-type-bg: #22304a;
            --tag-type-text: #5ecbfa;
            --tag-individual-bg: #1e2e22;
            --tag-individual-text: #39ff14;
            --tag-group-bg: #3a232e;
            --tag-group-text: #ffb4d4;
            --prereq-bg: #23262e;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 10px;
        }
        .dark-theme h1 {
            color: #e3e8f0;
            letter-spacing: 1px;
            text-shadow: 0 2px 8px #1118;
        }
        #fetchBtn {
            display: block;
            margin: 0 auto 20px;
            background-color: #2ecc71;
        }
        .controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        .filter-section {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            flex-grow: 1;
            min-width: 250px;
        }
        .dark-theme .filter-section {
            background: #23262e;
            box-shadow: 0 2px 8px rgba(0,0,0,0.8);
            border: 1px solid #232b3a;
        }
        .filter-section h3 {
            margin-top: 0;
            color: #3498db;
            margin-bottom: 12px;
        }
        .dark-theme .filter-section h3 {
            color: #5ecbfa;
        }
        .search-input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 100%;
            box-sizing: border-box;
        }
        .dark-theme .search-input {
            background: #181c22;
            color: #e3e8f0;
            border: 1px solid #333a47;
        }
        .checkbox-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .checkbox-item {
            display: flex;
            align-items: center;
            background-color: #f0f8ff;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .checkbox-item:hover {
            background-color: #e0f0ff;
        }
        .checkbox-item input {
            margin-right: 5px;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        .clear-filters {
            background-color: #e74c3c;
            margin-top: 10px;
        }
        .clear-filters:hover {
            background-color: #c0392b;
        }
        .dark-theme .clear-filters {
            background-color: #ff5c5c;
        }
        .dark-theme .clear-filters:hover {
            background-color: #c0392b;
        }
        .card-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        .course-card {
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease, background 0.4s;
            border: 2px solid transparent;
            position: relative;
        }
        .course-card[data-bg="Quiz/test"] {
            background: linear-gradient(135deg, #e3f2fd 70%, #fff 100%);
            border-color: #00eaff33;
        }
        .course-card[data-bg="Laboratory/practical"] {
            background: linear-gradient(135deg, #e8f5e9 70%, #fff 100%);
            border-color: #39ff1433;
        }
        .course-card[data-bg="Project"] {
            background: linear-gradient(135deg, #fff3e0 70%, #fff 100%);
            border-color: #ffb86c33;
        }
        .course-card[data-bg="Presentation"] {
            background: linear-gradient(135deg, #f3e0ff 70%, #fff 100%);
            border-color: #a259ff33;
        }
        .course-card[data-bg="Examination"] {
            background: linear-gradient(135deg, #ffe347 70%, #fff 100%);
            border-color: #ffe34733;
        }
        .dark-theme .course-card[data-bg="Quiz/test"] {
            background: linear-gradient(135deg, #1a2a38 70%, #23262e 100%);
            border-color: var(--neon-blue);
            box-shadow: 0 0 16px 0 var(--neon-blue), var(--shadow);
        }
        .dark-theme .course-card[data-bg="Laboratory/practical"] {
            background: linear-gradient(135deg, #1e2e22 70%, #23262e 100%);
            border-color: var(--neon-green);
            box-shadow: 0 0 16px 0 var(--neon-green), var(--shadow);
        }
        .dark-theme .course-card[data-bg="Project"] {
            background: linear-gradient(135deg, #2d2320 70%, #23262e 100%);
            border-color: var(--neon-orange);
            box-shadow: 0 0 16px 0 var(--neon-orange), var(--shadow);
        }
        .dark-theme .course-card[data-bg="Presentation"] {
            background: linear-gradient(135deg, #2a1a38 70%, #23262e 100%);
            border-color: var(--neon-purple);
            box-shadow: 0 0 16px 0 var(--neon-purple), var(--shadow);
        }
        .dark-theme .course-card[data-bg="Examination"] {
            background: linear-gradient(135deg, #2a2a1a 70%, #23262e 100%);
            border-color: var(--neon-yellow);
            box-shadow: 0 0 16px 0 var(--neon-yellow), var(--shadow);
        }
        .dark-theme .course-card {
            background: var(--card-bg);
            box-shadow: var(--shadow);
            border: 1px solid #232b3a;
        }
        .card-header {
            background: var(--header-bg);
            color: var(--header-text);
            padding: 15px;
        }
        .dark-theme .card-header {
            background: linear-gradient(90deg, #23262e 80%, #22304a 100%);
            color: var(--header-text);
            border-bottom: 1px solid #232b3a;
        }
        .card-header h2 {
            margin: 0;
            font-size: 18px;
        }
        .card-header p {
            margin: 5px 0 0;
            font-size: 14px;
            opacity: 0.9;
        }
        .card-body {
            padding: 15px;
        }
        .assessment-item {
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid #eee;
        }
        .dark-theme .assessment-item {
            border-bottom: 1px solid #232b3a;
        }
        .assessment-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        .assessment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        .assessment-title {
            font-weight: bold;
            color: #2c3e50;
        }
        .dark-theme .assessment-title {
            color: #e3e8f0;
        }
        .assessment-weight {
            background: #f1c40f;
            color: #7f5200;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: bold;
        }
        .dark-theme .assessment-weight {
            background: #ffe082;
            color: #7f5200;
        }
        .assessment-details {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            color: #7f8c8d;
        }
        .dark-theme .assessment-details {
            color: #b0b8c1;
        }
        .workload-indicator {
            height: 6px;
            background: #ecf0f1;
            border-radius: 3px;
            margin-top: 15px;
            overflow: hidden;
        }
        .workload-bar {
            height: 100%;
            background: linear-gradient(to right, #2ecc71, #e74c3c);
            width: 0;
            transition: width 0.5s ease;
        }
        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 5px;
            font-size: 12px;
            color: #7f8c8d;
        }
        .tag {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 6px;
            font-size: 13px;
            margin-right: 7px;
            margin-bottom: 5px;
            font-weight: 600;
            letter-spacing: 0.5px;
            box-shadow: 0 1px 8px #0002;
            border: none;
            background: #e8f4fc;
            color: #3498db;
            position: relative;
            transition: background 0.2s, color 0.2s, box-shadow 0.2s;
        }
        .dark-theme .tag {
            background: #181c22;
            color: #fff;
            border: none;
            box-shadow: 0 0 8px 1px #111a;
        }
        .tag-type {
            background: #e3f2fd;
            color: #1976d2;
        }
        .dark-theme .tag-type {
            background: transparent;
            color: var(--neon-blue);
            text-shadow: 0 0 6px var(--neon-blue), 0 0 2px #fff;
            box-shadow: 0 0 8px 2px var(--neon-blue);
            border: 1.5px solid var(--neon-blue);
        }
        .tag-individual {
            background: #e8f5e9;
            color: #388e3c;
        }
        .dark-theme .tag-individual {
            background: transparent;
            color: var(--neon-green);
            text-shadow: 0 0 6px var(--neon-green), 0 0 2px #fff;
            box-shadow: 0 0 8px 2px var(--neon-green);
            border: 1.5px solid var(--neon-green);
        }
        .tag-group {
            background: #fff3e0;
            color: #e65100;
        }
        .dark-theme .tag-group {
            background: transparent;
            color: var(--neon-orange);
            text-shadow: 0 0 6px var(--neon-orange), 0 0 2px #fff;
            box-shadow: 0 0 8px 2px var(--neon-orange);
            border: 1.5px solid var(--neon-orange);
        }
        .tag-presentation {
            background: #f3e0ff;
            color: #a259ff;
        }
        .dark-theme .tag-presentation {
            background: transparent;
            color: var(--neon-purple);
            text-shadow: 0 0 6px var(--neon-purple), 0 0 2px #fff;
            box-shadow: 0 0 8px 2px var(--neon-purple);
            border: 1.5px solid var(--neon-purple);
        }
        .tag-exam {
            background: #ffe347;
            color: #bfa800;
        }
        .dark-theme .tag-exam {
            background: transparent;
            color: var(--neon-yellow);
            text-shadow: 0 0 6px var(--neon-yellow), 0 0 2px #fff;
            box-shadow: 0 0 8px 2px var(--neon-yellow);
            border: 1.5px solid var(--neon-yellow);
        }
        .tag-other {
            background: #ffebee;
            color: #ff4f4f;
        }
        .dark-theme .tag-other {
            background: transparent;
            color: var(--neon-pink);
            text-shadow: 0 0 6px var(--neon-pink), 0 0 2px #fff;
            box-shadow: 0 0 8px 2px var(--neon-pink);
            border: 1.5px solid var(--neon-pink);
        }
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
            grid-column: 1 / -1;
        }
        .dark-theme .empty-state {
            color: #b0b8c1;
        }
        .assessment-intent {
            font-size: 12px;
            color: #666;
            margin: 3px 0;
            font-style: italic;
        }

        .tag-type {
            background-color: var(--tag-type-bg);
            color: var(--tag-type-text);
            border: 1px solid #2a3b5a;
        }

        .dark-theme .tag-type {
            background-color: var(--tag-type-bg);
            color: var(--tag-type-text);
            border: 1px solid #2a3b5a;
        }

        .tag-individual {
            background-color: var(--tag-individual-bg);
            color: var(--tag-individual-text);
            border: 1px solid #2a3b2a;
        }

        .dark-theme .tag-individual {
            background-color: var(--tag-individual-bg);
            color: var(--tag-individual-text);
            border: 1px solid #2a3b2a;
        }

        .tag-group {
            background-color: var(--tag-group-bg);
            color: var(--tag-group-text);
            border: 1px solid #3a2a3a;
        }

        .dark-theme .tag-group {
            background-color: var(--tag-group-bg);
            color: var(--tag-group-text);
            border: 1px solid #3a2a3a;
        }

        .assessment-details {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 5px;
        }
        .prerequisites {
            background-color: var(--prereq-bg);
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .prerequisites p {
            margin: 0;
        }

        .assessment-details .tag {
            display: inline-block;
            padding: 3px 8px;
            margin-right: 8px;
            border-radius: 4px;
            font-size: 12px;
        }

        .assessment-details .tag:nth-child(1) {
            background-color: #e3f2fd;
            color: #1976d2;
        }

        .assessment-details .tag:nth-child(2) {
            background-color: #e8f5e9;
            color: #388e3c;
        }
        /* Custom filter pill styles */
        .filter-pill {
            display: inline-flex;
            align-items: center;
            border-radius: 16px;
            padding: 5px 14px;
            margin: 3px 6px 3px 0;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border: 2px solid transparent;
            background: #f0f8ff;
            color: var(--accent);
            transition: background 0.2s, color 0.2s, border 0.2s;
            user-select: none;
            position: relative;
        }
        .filter-pill.included {
            background: var(--accent);
            color: #fff;
            border-color: var(--accent);
        }
        .filter-pill.excluded {
            background: var(--danger);
            color: #fff;
            border-color: var(--danger);
        }
        .filter-pill .pill-x {
            margin-left: 8px;
            font-weight: bold;
            font-size: 15px;
            pointer-events: none;
        }
        .filter-pill:focus {
            outline: 2px solid var(--accent-dark);
        }
        .dark-theme .filter-pill {
            background: #1e293b;
            color: #4fc3f7;
            border-color: transparent;
        }
        .dark-theme .filter-pill.included {
            background: var(--accent);
            color: #181c22;
            border-color: var(--accent);
        }
        .dark-theme .filter-pill.excluded {
            background: var(--danger);
            color: #fff;
            border-color: var(--danger);
        }
        .dark-theme .filter-pill:focus {
            outline: 2px solid var(--accent-dark);
        }
        /* Work type backgrounds (light mode) */
        .course-card[data-work="Individual"] {
            background: linear-gradient(135deg, #e8f5e9 70%, #fff 100%);
            border-color: #39ff1433;
        }
        .course-card[data-work^="Group"] {
            background: linear-gradient(135deg, #fff3e0 70%, #fff 100%);
            border-color: #ffb86c33;
        }
        .course-card[data-work="Presentation"] {
            background: linear-gradient(135deg, #f3e0ff 70%, #fff 100%);
            border-color: #a259ff33;
        }
        .course-card[data-work="Examination"] {
            background: linear-gradient(135deg, #ffe347 70%, #fff 100%);
            border-color: #ffe34733;
        }
        /* Work type backgrounds (dark mode) */
        .dark-theme .course-card[data-work="Individual"] {
            background: linear-gradient(135deg, #1e2e22 70%, #23262e 100%);
            border-color: var(--neon-green);
            box-shadow: 0 0 16px 0 var(--neon-green), var(--shadow);
        }
        .dark-theme .course-card[data-work^="Group"] {
            background: linear-gradient(135deg, #2d2320 70%, #23262e 100%);
            border-color: var(--neon-orange);
            box-shadow: 0 0 16px 0 var(--neon-orange), var(--shadow);
        }
        .dark-theme .course-card[data-work="Presentation"] {
            background: linear-gradient(135deg, #2a1a38 70%, #23262e 100%);
            border-color: var(--neon-purple);
            box-shadow: 0 0 16px 0 var(--neon-purple), var(--shadow);
        }
        .dark-theme .course-card[data-work="Examination"] {
            background: linear-gradient(135deg, #2a2a1a 70%, #23262e 100%);
            border-color: var(--neon-yellow);
            box-shadow: 0 0 16px 0 var(--neon-yellow), var(--shadow);
        }
    </style>
</head>
<body>
    <h1>Course Assessment Dashboard</h1>
    <button id="fetchBtn">Fetch Courses</button>
    <div class="controls">
        <div class="filter-section">
            <h3>Filter by Assessment Type</h3>
            <div class="checkbox-container" id="assessmentTypeFilters"></div>
        </div>
        <div class="filter-section">
            <h3>Filter by Work Type</h3>
            <div class="checkbox-container" id="workTypeFilters"></div>
        </div>
        <div class="filter-section">
            <h3>Search</h3>
            <input type="text" id="searchInput" class="search-input" placeholder="Search by course name or code...">
            <button class="clear-filters" id="clearFilters">Clear Filters</button>
        </div>
        <div class="filter-section">
            <h3>Theme</h3>
            <button id="themeToggle">ðŸŒ™ Dark</button>
        </div>
    </div>
    <div class="card-container" id="courseContainer"></div>

    <script>
    let courses = [];
    // Filter state: Map<filterName, 0|1|-1> (0=neutral, 1=include, -1=exclude)
    let assessmentTypeFilterState = new Map();
    let workTypeFilterState = new Map();

    async function fetchAndInit(codes) {
        const resp = await fetch('/api/courses', {
            method: 'POST',
            headers: {'Content-Type':'application/json'},
            body: JSON.stringify({ subject_codes: codes })
        });
        const raw = await resp.json();
        courses = raw.map(c => ({
            code: c.code,
            name: c.title,
            prerequisites: c.requisites || "None specified",
            assessments: c.assessment.map(a => {
                // Based on the actual JSON structure you provided
                return {
                    name: a.title,
                    type: a.details['Type'] || 'Unknown',
                    groupwork: a.details['Groupwork'] || 'Individual',
                    weight: Number((a.details['Weight']||'0').replace('%','')) || 0,
                    length: a.details['Length'] || 'Not specified',
                    intent: a.details['Intent'] || ''
                };
            })
        }));
        initializeDashboard();
    }

    // Helper function to determine groupwork status
    function determineGroupwork(groupworkText) {
        if (!groupworkText) return 'Individual';
        
        groupworkText = groupworkText.toLowerCase();
        if (groupworkText.includes('individual') || groupworkText === 'no') {
            return 'Individual';
        } else if (groupworkText.includes('group') || 
                groupworkText.includes('team') || 
                groupworkText.includes('pair')) {
            return 'Group';
        }
        
        // Try to get group size if specified
        const sizeMatch = groupworkText.match(/\d+/);
        if (sizeMatch) {
            return `Group (${sizeMatch[0]})`;
        }
        
        return groupworkText;
    }

    document.getElementById('fetchBtn').addEventListener('click', () => {
    const input = prompt(`Paste your course list here:
    Example:
    Autumn session
    33130 Mathematics 1     6cp
    41039 Programming 1     6cp
    ...`);

        if (!input) return;

        // Match all 5-digit course codes
        const codes = [...new Set(input.match(/\b\d{5}\b/g))];

        if (codes.length > 0) {
            fetchAndInit(codes);
        } else {
            alert('No valid course codes found.');
        }
    });


    function initializeDashboard() {
        renderFilters();
        renderCourses();
    }

    function renderFilters() {
        const assessmentTypeFilters = document.getElementById('assessmentTypeFilters');
        const workTypeFilters = document.getElementById('workTypeFilters');
        const allAssessmentTypes = new Set();
        const allWorkTypes = new Set();

        courses.forEach(course => {
            course.assessments.forEach(a => {
                allAssessmentTypes.add(a.type);
                allWorkTypes.add(a.groupwork);
            });
        });

        function createPill(label, filterMap, container) {
            let state = filterMap.get(label) || 0;
            const pill = document.createElement('span');
            pill.className = 'filter-pill';
            if (state === 1) pill.classList.add('included');
            if (state === -1) pill.classList.add('excluded');
            pill.tabIndex = 0;
            pill.textContent = label;
            if (state === -1) {
                const x = document.createElement('span');
                x.className = 'pill-x';
                x.textContent = 'âœ•';
                pill.appendChild(x);
            }
            pill.addEventListener('click', () => {
                // Cycle: 0 -> 1 -> -1 -> 0
                let newState = state === 0 ? 1 : (state === 1 ? -1 : 0);
                if (newState === 0) filterMap.delete(label);
                else filterMap.set(label, newState);
                renderFilters();
                renderCourses();
            });
            pill.addEventListener('keydown', (e) => {
                if (e.key === ' ' || e.key === 'Enter') {
                    pill.click();
                    e.preventDefault();
                }
            });
            container.appendChild(pill);
        }

        assessmentTypeFilters.innerHTML = '';
        Array.from(allAssessmentTypes).sort().forEach(t => createPill(t, assessmentTypeFilterState, assessmentTypeFilters));
        workTypeFilters.innerHTML = '';
        Array.from(allWorkTypes).sort().forEach(w => createPill(w, workTypeFilterState, workTypeFilters));
    }

    function renderCourses() {
        const container = document.getElementById('courseContainer');
        const searchVal = document.getElementById('searchInput').value.toLowerCase();
        container.innerHTML = '';

        function filterByState(val, map) {
            if (map.size === 0) return true;
            if (map.get(val) === 1) return true;
            if (map.get(val) === -1) return false;
            // If any includes exist, only show those
            if ([...map.values()].includes(1)) return map.get(val) === 1;
            // If any excludes exist, exclude those
            if ([...map.values()].includes(-1)) return map.get(val) !== -1;
            return true;
        }

        const filteredCourses = courses.filter(course => {
            if (searchVal && !(course.name.toLowerCase().includes(searchVal) || course.code.includes(searchVal))) {
                return false;
            }
            // At least one assessment matches both filters
            return course.assessments.some(a =>
                filterByState(a.type, assessmentTypeFilterState) &&
                filterByState(a.groupwork, workTypeFilterState)
            );
        });

        if (filteredCourses.length === 0) {
            const empty = document.createElement('div');
            empty.className = 'empty-state';
            empty.textContent = 'No courses match the filters.';
            container.appendChild(empty);
            return;
        }

        filteredCourses.forEach(course => {
            // Determine main work type for background
            const mainWork = getMainWorkType(course);
            const card = document.createElement('div');
            card.className = 'course-card';
            card.setAttribute('data-work', mainWork);

            const header = document.createElement('div');
            header.className = 'card-header';
            header.innerHTML = `<h2>${course.code}</h2><p>${course.name}</p>`;

            const body = document.createElement('div');
            body.className = 'card-body';
            
            // Add prerequisites section
            const prereqs = document.createElement('div');
            prereqs.className = 'prerequisites';
            prereqs.innerHTML = `
                <p><strong>Prerequisites:</strong> ${course.prerequisites}</p>
            `;
            body.appendChild(prereqs);
            
            // Add a divider
            const divider = document.createElement('hr');
            divider.style.borderTop = '1px solid #eee';
            divider.style.margin = '10px 0';
            body.appendChild(divider);
            
            // Assessments section
            const assessmentsTitle = document.createElement('h3');
            assessmentsTitle.textContent = 'Assessments';
            assessmentsTitle.style.margin = '0 0 10px 0';
            assessmentsTitle.style.fontSize = '16px';
            body.appendChild(assessmentsTitle);
            
            course.assessments.forEach(a => {
                const item = document.createElement('div');
                item.className = 'assessment-item';
                
                // Determine groupwork tag color class
                let groupworkClass = 'tag-individual';
                if (a.groupwork.toLowerCase().includes('group')) {
                    groupworkClass = 'tag-group';
                }
                
                // Neon tag for assessment type
                const typeTagClass = getTypeTagClass(a.type);

                item.innerHTML = `
                    <div class="assessment-header">
                        <span class="assessment-title">${a.name}</span>
                        <span class="assessment-weight">${a.weight}%</span>
                    </div>
                    <div class="assessment-intent">${a.intent}</div>
                    <div class="assessment-details">
                        <span class="tag ${typeTagClass}">${a.type}</span>
                        <span class="tag ${groupworkClass}">${a.groupwork}</span>
                    </div>
                `;
                body.appendChild(item);
            });

            card.appendChild(header);
            card.appendChild(body);
            container.appendChild(card);
        });
    }

    document.getElementById('clearFilters').addEventListener('click', () => {
        assessmentTypeFilterState.clear();
        workTypeFilterState.clear();
        document.getElementById('searchInput').value = '';
        renderFilters();
        renderCourses();
    });

    document.getElementById('searchInput').addEventListener('input', () => renderCourses());

    // Theme toggle
    const themeBtn = document.getElementById('themeToggle');
    function setTheme(dark) {
        document.body.classList.toggle('dark-theme', dark);
        themeBtn.textContent = dark ? 'â˜€ï¸ Light' : 'ðŸŒ™ Dark';
        localStorage.setItem('theme', dark ? 'dark' : 'light');
    }
    themeBtn.addEventListener('click', () => {
        setTheme(!document.body.classList.contains('dark-theme'));
    });
    // On load, set theme from localStorage
    setTheme(localStorage.getItem('theme') === 'dark');

    // Helper: get main assessment type for subject
    function getMainAssessmentType(course) {
        if (!course.assessments || course.assessments.length === 0) return '';
        // Priority: Project > Laboratory/practical > Presentation > Quiz/test > Examination > Other
        const typeOrder = [
            "Project", "Laboratory/practical", "Presentation", "Quiz/test", "Examination"
        ];
        let found = '';
        for (const t of typeOrder) {
            if (course.assessments.some(a => (a.type||'').toLowerCase().includes(t.toLowerCase()))) {
                found = t;
                break;
            }
        }
        if (!found) {
            found = (course.assessments[0].type || 'Other');
        }
        return found;
    }
    // Helper: get tag class for assessment type
    function getTypeTagClass(type) {
        const t = (type||'').toLowerCase();
        if (t.includes('project')) return 'tag-type tag-project';
        if (t.includes('lab')) return 'tag-type tag-individual';
        if (t.includes('presentation')) return 'tag-type tag-presentation';
        if (t.includes('quiz') || t.includes('test')) return 'tag-type tag-type';
        if (t.includes('exam')) return 'tag-type tag-exam';
        return 'tag-type tag-other';
    }
    // Helper: get main work type for subject
    function getMainWorkType(course) {
        if (!course.assessments || course.assessments.length === 0) return '';
        // Priority: Group > Presentation > Examination > Individual > Other
        const workOrder = [
            "Group", "Presentation", "Examination", "Individual"
        ];
        let found = '';
        for (const t of workOrder) {
            if (course.assessments.some(a => (a.groupwork||'').toLowerCase().includes(t.toLowerCase()))) {
                found = t;
                break;
            }
        }
        if (!found) {
            found = (course.assessments[0].groupwork || 'Other');
        }
        return found;
    }
    </script>
</body>
</html>
